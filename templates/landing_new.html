<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Primary Meta Tags -->
    <title>IL9Cast - Illinois 9th District Democratic Primary 2026 Forecast</title>
    <meta name="title" content="IL9Cast - Illinois 9th District Democratic Primary 2026 Forecast">
    <meta name="description" content="Live prediction market aggregation for Illinois 9th District Democratic Primary election on March 17, 2026. Real-time odds from Manifold Markets and Kalshi, updated every 3 minutes.">
    <meta name="keywords" content="IL9Cast, Illinois 9th District, Democratic Primary, primary election 2026, prediction markets, Manifold Markets, Kalshi, election forecast, Daniel Biss, Jan Schakowsky">
    <link rel="canonical" href="https://il9.org/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://il9.org/">
    <meta property="og:title" content="IL9Cast - Illinois 9th District Democratic Primary 2026 Forecast">
    <meta property="og:description" content="Live prediction market aggregation for Illinois 9th District Democratic Primary. Real-time odds updated every 3 minutes from Manifold Markets and Kalshi.">
    <meta property="og:site_name" content="IL9Cast">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://il9.org/">
    <meta property="twitter:title" content="IL9Cast - Illinois 9th District Democratic Primary 2026 Forecast">
    <meta property="twitter:description" content="Live prediction market aggregation for Illinois 9th District Democratic Primary. Real-time odds updated every 3 minutes.">

    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='landing-style.css') }}">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WVTWQBBG8S"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WVTWQBBG8S');
    </script>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "IL9Cast",
        "url": "https://il9.org",
        "description": "Live prediction market aggregation for Illinois 9th District Democratic Primary election on March 17, 2026",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://il9.org/?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Event",
        "name": "Illinois 9th District Democratic Primary Election",
        "startDate": "2026-03-17T19:00:00-06:00",
        "endDate": "2026-03-17T20:00:00-06:00",
        "eventStatus": "https://schema.org/EventScheduled",
        "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
        "location": {
            "@type": "Place",
            "name": "Illinois 9th Congressional District",
            "address": {
                "@type": "PostalAddress",
                "addressRegion": "IL",
                "addressCountry": "US"
            }
        },
        "description": "Democratic Primary election for Illinois 9th Congressional District"
    }
    </script>
</head>
<script>
    // Apply saved theme BEFORE paint to prevent flash
    (function() {
        var t = localStorage.getItem('il9-theme');
        if (t === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
    })();
</script>
<body>

    <div class="site-content">
        <!-- HEADER -->
        <header>
            <a href="/" class="logo">IL9<span>Cast</span></a>
            <nav class="desktop-nav">
                <a href="/odds">Model</a>
                <a href="/markets">Markets</a>
                <a href="/candidates">Candidates</a>
                <a href="/fundraising">Fundraising</a>
                <a href="/methodology">Methodology</a>
                <a href="/about">About</a>
            </nav>
            <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
                <svg class="icon-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                <svg class="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </button>
            <button class="hamburger" id="hamburger" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="mobile-nav" id="mobileNav">
                <a href="/odds">Model</a>
                <a href="/markets">Markets</a>
                <a href="/candidates">Candidates</a>
                <a href="/fundraising">Fundraising</a>
                <a href="/methodology">Methodology</a>
                <a href="/about">About</a>
            </nav>
        </header>

        <!-- HERO -->
        <section class="hero" id="home">
            <div class="hero-dateline">
                <span class="dot"></span>
                Live data &mdash; Updated every 3 minutes
            </div>
            <h1>Illinois 9th District,<br><em>Democratic Primary Forecast</em></h1>
            <p class="hero-subtitle">Aggregating prediction market data from Manifold Markets and Kalshi for the March 17, 2026 primary election.</p>
            <p class="hero-countdown"><span id="countdownCompact">--</span> until polls close &mdash; March 17, 2026 at 7:00 PM CT</p>
        </section>

        <div class="hero-rule"><hr></div>

        <!-- STAT BOXES -->
        <div class="stat-strip">
            <div class="stat-grid">
                <div class="stat-box">
                    <div class="stat-label">Data Points</div>
                    <div class="stat-value" id="dataPointCount">--</div>
                    <div class="stat-detail">Across <span id="snapshotCount">--</span> snapshots</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Market Leader</div>
                    <div class="stat-value" id="marketLeader">--</div>
                    <div class="stat-detail" id="marketLeaderDetail">Loading aggregate data</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Election Day</div>
                    <div class="stat-value">Mar 17</div>
                    <div class="stat-detail">Democratic Primary</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Raised</div>
                    <div class="stat-value" id="totalRaised">--</div>
                    <div class="stat-detail">Extrapolated to current date</div>
                </div>
            </div>
        </div>

        <!-- EXPLORE SECTION -->
        <section class="editorial-section">
            <div class="section-label">Explore</div>
            <div class="nav-cards">
                <a href="/markets" class="nav-card">
                    <div class="nav-card-type">Aggregated Odds</div>
                    <div class="nav-card-title">Live Prediction Markets</div>
                    <div class="nav-card-desc">Real-time weighted aggregation from Manifold Markets and Kalshi with historical charting.</div>
                    <div class="nav-card-arrow">View markets &rarr;</div>
                </a>
                <a href="/candidates" class="nav-card">
                    <div class="nav-card-type">Candidate Profiles</div>
                    <div class="nav-card-title">The Candidates</div>
                    <div class="nav-card-desc">Profiles and current odds for all candidates in the IL-9 Democratic primary race.</div>
                    <div class="nav-card-arrow">View candidates &rarr;</div>
                </a>
                <a href="/odds" class="nav-card">
                    <div class="nav-card-type">Precinct Simulation</div>
                    <div class="nav-card-title">Forecast Model</div>
                    <div class="nav-card-desc">Monte Carlo simulation across 436 precincts with interactive map and detailed results.</div>
                    <div class="nav-card-arrow">View model &rarr;</div>
                </a>
            </div>
        </section>

        <!-- FEATURED CASE STUDY -->
        <section class="editorial-section">
            <div class="section-label">Featured Analysis</div>
            <a href="/case-study/bid-ask-spreads" class="featured-card">
                <div class="featured-card-inner">
                    <span class="featured-card-tag">Case Study</span>
                    <h2 class="featured-card-title">Bid-Ask Spreads Even Moses Can't Part</h2>
                    <p class="featured-card-desc">A trader pushed Laura Fine to 30% on Kalshi. The spread said 14&ndash;16%. Every other tracker parroted the spike. Here's why IL9Cast didn't flinch.</p>
                    <span class="featured-card-arrow">Read the full analysis &rarr;</span>
                </div>
            </a>
        </section>

        <!-- ABOUT SECTION -->
        <section class="editorial-section">
            <div class="section-label">About this project</div>
            <div class="about-block">
                <div class="about-block-text">
                    <strong>IL9Cast</strong> is an independent forecast aggregator for the Illinois 9th District Democratic Primary. We combine prediction market data from multiple platforms using a weighted formula, apply multi-layer smoothing for clean visualizations, and store every data point for full transparency.
                </div>
                <ul class="about-block-list">
                    <li>
                        <strong>Manifold Markets</strong>
                        40% weight in aggregation formula
                    </li>
                    <li>
                        <strong>Kalshi</strong>
                        60% weight (last price, midpoint, liquidity-adjusted)
                    </li>
                    <li>
                        <strong>Open Data</strong>
                        Full historical dataset available for download
                    </li>
                </ul>
            </div>

            <div class="cta-row">
                <a href="/markets" class="btn-primary">View Live Markets</a>
                <a href="/api/download/snapshots" class="btn-secondary">Download Data</a>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="site-footer">
            <hr class="footer-rule">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Navigate</h4>
                    <ul>
                        <li><a href="/markets">Markets</a></li>
                        <li><a href="/candidates">Candidates</a></li>
                        <li><a href="/fundraising">Fundraising</a></li>
                        <li><a href="/methodology">Methodology</a></li>
                        <li><a href="/about">About</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="/api/download/snapshots">Download Data</a></li>
                        <li><a href="https://github.com/de-bayes/IL9" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                        <li><a href="https://buy.stripe.com/4gMdR98o72FP77e7jX1sQ00" target="_blank" rel="noopener noreferrer">Support This Project</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Disclaimer</h4>
                    <p>Prediction markets involve risk. Past performance does not guarantee future results. This platform aggregates public market data for informational purposes only.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <span>&copy; 2026 IL9Cast. Built with open data.</span>
                <a href="https://buy.stripe.com/4gMdR98o72FP77e7jX1sQ00" target="_blank" rel="noopener noreferrer" class="footer-support-link">Support This Project</a>
            </div>
        </footer>

        <div class="flag-footer-image">
            <img src="{{ url_for('static', filename='flag-footer.png') }}" alt="Illinois Flag Footer">
        </div>
    </div>

    <script>
        // Theme toggle with localStorage persistence
        function toggleTheme() {
            var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            if (isDark) {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('il9-theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('il9-theme', 'dark');
            }
        }

        // Mobile hamburger menu
        function toggleMobileMenu() {
            const hamburger = document.getElementById('hamburger');
            const mobileNav = document.getElementById('mobileNav');
            hamburger.classList.toggle('active');
            mobileNav.classList.toggle('active');
        }

        document.querySelectorAll('#mobileNav a').forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('hamburger').classList.remove('active');
                document.getElementById('mobileNav').classList.remove('active');
            });
        });

        document.addEventListener('click', (e) => {
            const hamburger = document.getElementById('hamburger');
            const mobileNav = document.getElementById('mobileNav');
            if (!hamburger.contains(e.target) && !mobileNav.contains(e.target)) {
                hamburger.classList.remove('active');
                mobileNav.classList.remove('active');
            }
        });

        // Fetch snapshot count and data points
        async function loadStats() {
            try {
                const resp = await fetch('/api/snapshots/count');
                const data = await resp.json();
                const snapshots = data.snapshots || data.count || 0;
                const dataPoints = data.data_points || 0;

                animateValue('dataPointCount', dataPoints);
                const snapshotEl = document.getElementById('snapshotCount');
                if (snapshotEl) {
                    snapshotEl.textContent = snapshots.toLocaleString();
                }
            } catch (e) {
                console.error('Failed to fetch stats:', e);
            }
        }

        // Fetch current market leader from latest aggregate snapshot
        async function loadMarketLeader() {
            try {
                const resp = await fetch('/api/snapshots');
                const snapshots = await resp.json();
                if (snapshots && snapshots.length > 0) {
                    const latest = snapshots[snapshots.length - 1];
                    if (latest.candidates && latest.candidates.length > 0) {
                        const sorted = latest.candidates.sort((a, b) => b.probability - a.probability);
                        const leader = sorted[0];
                        const leaderEl = document.getElementById('marketLeader');
                        const detailEl = document.getElementById('marketLeaderDetail');
                        // Clean name
                        let name = leader.name || '';
                        name = name.replace(/\s*(will )?(be the democratic nominee|win|for IL-?9).*$/i, '').trim();
                        const parts = name.split(' ');
                        const displayName = parts.length > 1 ? parts[parts.length - 1] : name;
                        const prob = Math.round(leader.probability * 10) / 10;
                        if (leaderEl) leaderEl.textContent = displayName;
                        if (detailEl) detailEl.textContent = prob + '% aggregate probability';
                    }
                }
            } catch (e) {
                console.error('Failed to fetch market leader:', e);
            }
        }

        // Fetch total raised from FEC data (extrapolated to current date)
        async function loadFundraisingTotal() {
            try {
                const resp = await fetch('/api/fec/candidates');
                const data = await resp.json();
                var candidates = data.candidates || data;
                if (!Array.isArray(candidates)) return;

                var totalRaised = 0;
                for (var i = 0; i < candidates.length; i++) {
                    totalRaised += candidates[i].total_raised || 0;
                }

                // Extrapolate to current date using same logic as fundraising page
                var campaignStartDates = {
                    "Daniel Biss": "2024-06-01",
                    "Kat Abugazaleh": "2024-08-01",
                    "Laura Fine": "2024-07-01",
                    "Mike Simmons": "2025-01-01",
                    "Phil Andrew": "2024-09-01",
                    "Bushra Amiwala": "2024-05-01"
                };

                var totalVelocity = 0;
                for (var j = 0; j < candidates.length; j++) {
                    var c = candidates[j];
                    var startStr = campaignStartDates[c.name];
                    if (startStr) {
                        var start = new Date(startStr);
                        var fecEnd = c.name === "Bushra Amiwala"
                            ? new Date("2025-09-30")
                            : new Date("2025-12-31");
                        var daysActive = (fecEnd - start) / (1000 * 60 * 60 * 24);
                        if (daysActive > 0) {
                            totalVelocity += c.total_raised / daysActive;
                        }
                    }
                }

                var daysSinceFiling = (new Date() - new Date("2025-12-31")) / (1000 * 60 * 60 * 24);
                var estimatedTotal = totalRaised + (totalVelocity * daysSinceFiling);

                var el = document.getElementById('totalRaised');
                if (el) {
                    var millions = estimatedTotal / 1000000;
                    el.textContent = '$' + millions.toFixed(1) + 'M';
                }
            } catch (e) {
                console.error('Failed to fetch FEC data:', e);
            }
        }

        // Animate a number counting up
        function animateValue(elementId, target) {
            const el = document.getElementById(elementId);
            if (!el || !target) return;

            const duration = 1500;
            const startTime = Date.now();

            function easeOut(t) {
                return 1 - Math.pow(1 - t, 3);
            }

            function update() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.floor(easeOut(progress) * target);
                el.textContent = current.toLocaleString();

                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    el.textContent = target.toLocaleString();
                }
            }

            update();
        }

        // Countdown timer
        function updateCountdown() {
            const electionDate = new Date('2026-03-18T01:00:00Z'); // March 17 7PM CT
            const now = new Date();
            const timeDiff = electionDate - now;
            const countdownEl = document.getElementById('countdownCompact');
            if (!countdownEl) return;

            if (timeDiff <= 0) {
                countdownEl.textContent = 'Polls closed';
                return;
            }

            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));

            if (days > 0) {
                countdownEl.textContent = days + 'd ' + hours + 'h';
            } else if (hours > 0) {
                countdownEl.textContent = hours + 'h ' + minutes + 'm';
            } else {
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                countdownEl.textContent = minutes + 'm ' + seconds + 's';
            }
        }

        // Init
        window.addEventListener('load', () => {
            loadStats();
            loadMarketLeader();
            loadFundraisingTotal();
            updateCountdown();
            setInterval(updateCountdown, 1000);
        });
    </script>
</body>
</html>
