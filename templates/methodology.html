{% extends "base.html" %}

{% block title %}Methodology - IL9Cast{% endblock %}

{% block content %}
<div class="inner-page methodology-page">
    <nav class="inner-nav">
        <a href="/" class="back-link">IL9Cast</a>
        <div class="inner-nav-links">
            <a href="/odds">The Model</a>
            <a href="/markets">Markets</a>
            <a href="/fundraising">Fundraising</a>
            <a href="/methodology" class="active">Methodology</a>
            <a href="/about">About</a>
        </div>
    </nav>

    <div class="inner-content">
        <h1 class="inner-title">Methodology</h1>
        <p class="method-subtitle">How we aggregate prediction markets</p>

<section class="methodology-content">

    <article class="method-section">
        <h2>Prediction Markets Aggregation</h2>
        <p>The <a href="/markets">Markets page</a> aggregates real-time probabilities from two major prediction markets: <strong>Manifold Markets</strong> (community-driven) and <strong>Kalshi</strong> (real-money exchange). This provides a live, crowd-sourced forecast updated automatically as new trades occur.</p>

        <h3 style="margin-top: 1.5rem; font-size: 1.1rem;">Overall Weighting: 40% Manifold + 60% Kalshi</h3>

        <p><strong>Manifold Markets (40% weight):</strong></p>
        <ul class="method-list">
            <li>Community prediction market using play money</li>
            <li>Lower barrier to entry, broader participation</li>
            <li>Captures general consensus and casual forecasters</li>
            <li>Uses an Automated Market Maker (AMM) for price discovery</li>
            <li>Good for long-term sentiment, less susceptible to short-term noise</li>
        </ul>

        <p><strong>Kalshi (60% weight):</strong></p>
        <ul class="method-list">
            <li>Real-money exchange with cash-settled contracts</li>
            <li>Higher barrier to entry, attracts serious forecasters with skin in the game</li>
            <li>Reflects genuine conviction (money is at risk)</li>
            <li>Traditional order book exchange (bid/ask spread pricing)</li>
        </ul>

        <h3 style="margin-top: 1.5rem; font-size: 1.1rem;">Kalshi Component Breakdown (60% total weight)</h3>

        <p>Within Kalshi's 60% weight, we use three price signals:</p>

        <p><strong>1. Last Price (42% overall = 70% of Kalshi's 60%)</strong></p>
        <ul class="method-list">
            <li>The most recent completed trade price</li>
            <li>Reflects real money execution and recent market sentiment</li>
            <li>Given highest weight because it shows actual conviction backed by capital</li>
            <li>Most responsive to new information and recent trades</li>
        </ul>

        <p><strong>2. Midpoint (12% overall = 20% of Kalshi's 60%)</strong></p>
        <ul class="method-list">
            <li>Average of the current best bid and best ask prices: (bid + ask) / 2</li>
            <li>Represents the fair value between buyers and sellers right now</li>
            <li>Includes current order book state but not yet executed</li>
            <li>Smooths out last trade anomalies or outliers</li>
        </ul>

        <p><strong>3. Liquidity-Weighted Price (6% overall = 10% of Kalshi's 60%)</strong></p>
        <ul class="method-list">
            <li><strong>Purpose:</strong> Captures buying vs selling pressure by analyzing where the last trade occurred within the bid-ask spread</li>
            <li><strong>Why only Kalshi?</strong> Kalshi uses a traditional order book exchange where buyers and sellers post bids and asks. Manifold uses an Automated Market Maker (AMM) that algorithmically sets prices, so order book analysis doesn't apply</li>
            <li><strong>How it works:</strong> Calculate position in spread = (Last Price - Bid) / (Ask - Bid). Position of 0.0 = traded at bid (sellers aggressive), 0.5 = at midpoint (balanced), 1.0 = at ask (buyers aggressive)</li>
            <li><strong>Spread dampening:</strong> Wider spreads reduce the adjustment because they indicate less confidence. At 0pp spread: factor = 1.0 (full shift potential). At 10pp spread: factor = 0.2 (heavily dampened)</li>
            <li><strong>Example:</strong> Bid=60, Ask=68, Last=66, Mid=64, Spread=8. Position = (66-60)/8 = 0.75 (near ask). Offset = 0.75 - 0.5 = +0.25. Dampening = 1 - (8/10)×0.8 = 0.36. Shift = 0.25 × 6 × 0.36 = +0.54pp. Result = 64 + 0.54 = 64.5% (buyers showed aggression)</li>
            <li>Caps shift at ±3 percentage points to avoid overreaction</li>
        </ul>

        <h3 style="margin-top: 1.5rem; font-size: 1.1rem;">The Complete Formula</h3>
        <p style="font-family: monospace; background: rgba(0, 170, 220, 0.1); padding: 1rem; border-radius: 4px; margin: 1rem 0;">
            Aggregate Probability = (0.40 × Manifold) + (0.42 × Kalshi Last Price) + (0.12 × Kalshi Midpoint) + (0.06 × Kalshi Liquidity-Weighted)
        </p>

        <h3 style="margin-top: 1.5rem; font-size: 1.1rem;">Soft Normalization (30% Strength)</h3>
        <p>Final probabilities are lightly normalized to prevent excessive drift while preserving raw market values:</p>
        <ul class="method-list">
            <li>Candidates with no Kalshi market (marked with *) use 100% of their Manifold probability</li>
            <li>Only 30% of the normalization adjustment is applied to each candidate</li>
            <li>70% of the raw aggregated value is preserved</li>
            <li>This keeps top candidates higher while preventing probabilities from summing to unrealistic totals</li>
        </ul>

        <h3 style="margin-top: 1.5rem; font-size: 1.1rem;">Update Frequency</h3>
        <ul class="method-list">
            <li><strong>Default:</strong> Every 3 minutes</li>
            <li><strong>Final 3 days before election:</strong> Every 1 minute</li>
            <li><strong>Election day:</strong> Every 1 minute</li>
        </ul>

        <p>Historical snapshots are saved with every update and aggregated hourly for clean trend visualization.</p>
    </article>

    <article class="method-section contact-section">
        <h2>Questions?</h2>
        <p>IL9Cast's prediction market aggregation is maintained by <strong>Ryan McComb</strong>, a student at ETHS, as an educational project to help voters understand real-time sentiment in the Illinois 9th Democratic Primary race.</p>
        <p>For questions about the market aggregation methodology or to report data issues, please reach out directly.</p>
    </article>
</section>

<style scoped>
.methodology-content {
    max-width: 800px;
    margin: 0 auto;
}

.method-section {
    margin-bottom: 3rem;
    padding: 1.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.method-section:last-child {
    border-bottom: none;
}

.method-section h2 {
    margin-bottom: 1rem;
    font-size: 1.5rem;
    font-weight: 600;
}

.method-section p {
    margin-bottom: 1rem;
    line-height: 1.8;
    color: var(--text-secondary);
}

.method-list {
    list-style: none;
    padding-left: 0;
    margin: 1rem 0;
}

.method-list li {
    margin-bottom: 0.8rem;
    padding-left: 1.5rem;
    position: relative;
    line-height: 1.6;
    color: var(--text-secondary);
}

.method-list li:before {
    content: "→";
    position: absolute;
    left: 0;
    color: var(--accent-primary);
}

.contact-section {
    background: var(--bg-card);
    padding: 2rem;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
}

.method-section a {
    color: var(--accent-primary);
    text-decoration: none;
    border-bottom: 1px solid var(--accent-primary);
}

.method-section a:hover {
    opacity: 0.8;
}
</style>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.querySelector('.navbar');
    const footer = document.querySelector('.footer');
    if (navbar) navbar.style.display = 'none';
    if (footer) footer.style.display = 'none';
});
</script>
{% endblock %}
